<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ğŸ“… Crop Planner - Aeterna</title>
    <link rel="stylesheet" href="/src/assets/css/planner.css" />
  </head>
  <body>
    <div class="dashboard-container">
      <div class="dashboard-header">
        <div class="header-left">
          <a href="/index.html" class="back-btn">â† Back to Dashboard</a>
          <h1>ğŸ“… Crop Planning Center</h1>
          <p>Plan, schedule, and track your farming activities</p>
        </div>
        <div class="user-profile">
          <div id="user-display-name">User</div>
          <button class="logout-btn" onclick="logout()">Logout</button>
        </div>
      </div>

      <div class="page-content">
        <div class="planner-grid">
          <!-- Planning Form -->
          <div class="card">
            <div class="card-header">
              <h2>ğŸŒ± New Crop Plan</h2>
            </div>
            <div class="planning-form">
              <div class="form-row">
                <div class="form-group">
                  <label for="crop-type">Crop Type</label>
                  <select id="crop-type">
                    <option value="">Select a crop</option>
                    <option value="maize">Maize</option>
                    <option value="wheat">Wheat</option>
                    <option value="rice">Rice</option>
                    <option value="beans">Beans</option>
                    <option value="tomato">Tomato</option>
                    <option value="potato">Potato</option>
                    <option value="sorghum">Sorghum</option>
                    <option value="millet">Millet</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="variety">Variety</label>
                  <input type="text" id="variety" placeholder="Crop variety" />
                </div>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label for="planting-date">Planting Date</label>
                  <input type="date" id="planting-date" />
                </div>
                <div class="form-group">
                  <label for="area">Area (acres)</label>
                  <input
                    type="number"
                    id="area"
                    value="1"
                    min="0.1"
                    step="0.1"
                  />
                </div>
              </div>

              <div class="form-group">
                <label for="notes">Notes & Requirements</label>
                <textarea
                  id="notes"
                  rows="3"
                  placeholder="Special requirements, soil prep notes..."
                ></textarea>
              </div>

              <div class="form-actions">
                <button
                  onclick="plannerApp.createPlan()"
                  class="btn-primary btn-large"
                >
                  ğŸ“… Create Crop Plan
                </button>
              </div>
            </div>
          </div>

          <!-- Plan Summary -->
          <div class="card">
            <div class="card-header">
              <h2>ğŸ“Š Plan Summary</h2>
            </div>
            <div id="plan-summary">
              <div class="empty-state">
                <div class="empty-icon">ğŸ“…</div>
                <h3>No Active Plan</h3>
                <p>Create a crop plan to see the schedule and tasks.</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Current Plans -->
        <div class="card">
          <div class="card-header">
            <h2>ğŸŒ¾ Active Crop Plans</h2>
            <button onclick="plannerApp.showAllPlans()" class="btn-outline">
              View All Plans
            </button>
          </div>
          <div id="active-plans">
            <div class="loading">
              <div class="spinner"></div>
              <p>Loading your crop plans...</p>
            </div>
          </div>
        </div>

        <!-- Calendar View -->
        <div class="calendar-view">
          <div class="card-header">
            <h2>ğŸ“… Farming Calendar</h2>
            <div class="calendar-nav">
              <button onclick="plannerApp.previousMonth()" class="btn-outline">
                â† Prev
              </button>
              <span id="current-month" style="font-weight: 600"></span>
              <button onclick="plannerApp.nextMonth()" class="btn-outline">
                Next â†’
              </button>
            </div>
          </div>
          <div id="calendar-container">
            <!-- Calendar will be generated by JavaScript -->
          </div>
        </div>

        <!-- Upcoming Tasks -->
        <div class="card">
          <div class="card-header">
            <h2>âœ… Upcoming Tasks</h2>
          </div>
          <div id="upcoming-tasks">
            <div class="loading">
              <div class="spinner"></div>
              <p>Loading upcoming tasks...</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script src="/src/assets/js/utils.js"></script>
    <script src="/src/assets/js/session.js"></script>
    <script src="/src/components/planner/planner.js"></script>
    <script>
      const plannerApp = new PlannerApp();
      document.addEventListener("DOMContentLoaded", function () {
        ensureSession().then(function () {
          const userData = getCookie("user_data");
          if (userData) {
            try {
              const user = JSON.parse(userData);
              document.getElementById("user-display-name").textContent =
                user.full_name || user.username;
            } catch (e) {}
          }
          plannerApp.initialize();
        });
      });
    </script>
  </body>
</html>
